<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ressourcenretter / rettung — Info</title>
  <style>
    :root{--bg:#f7fafc;--card:#ffffff;--muted:#6b7280;--accent:#16a34a}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; background:var(--bg); color:#111}
    .wrap{max-width:900px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;gap:16px}
    .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,#10b98133,#06b6d433);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent)}
    h1{margin:0;font-size:1.5rem}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,0.06);margin-top:16px}
    .muted{color:var(--muted)}
    .levels{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .level{flex:1;min-width:180px;padding:12px;border-radius:10px;border:1px solid #e6edf2}
    .level h3{margin:0 0 8px 0}
    .feed{margin-top:14px}
    .announce{padding:10px;border-radius:8px;margin-bottom:8px;border:1px solid #edf2f7}
    .controls{display:flex;gap:8px;align-items:center;margin-top:12px}
    button{background:var(--accent);color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    footer{margin-top:20px;color:var(--muted);font-size:0.9rem}
    @media (max-width:600px){.levels{flex-direction:column}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">RR</div>
      <div>
        <h1>Ressourcenretter Engelskirchen</h1>
        <div class="muted">Private WhatsApp-Gruppe • 104 Mitglieder</div>
      </div>
    </header>

    <section class="card">
      <h2>Worum geht's?</h2>
      <p class="muted">Wir retten überschüssige / noch gute Produkte und geben sie an Interessierte weiter. Alle Details, Koordination und Bilder sind in der privaten WhatsApp-Gruppe. Diese Seite dient als öffentliche Info-Übersicht für Gruppe, Ort und typische Abläufe.</p>

      <div class="levels">
        <div class="level">
          <h3>Kleine Rettung</h3>
          <p class="muted">Wenn nur wenig Produkte vorhanden sind (ein paar Packungen / einzelne Artikel). Ideal zum spontanen Mitnehmen.</p>
        </div>
        <div class="level">
          <h3>Mittlere Rettung</h3>
          <p class="muted">Wenn mehrere, aber nicht viele Produkte vorhanden sind. Gut für mehrere Haushalte.</p>
        </div>
        <div class="level">
          <h3>Große Rettung</h3>
          <p class="muted">Viele Produkte — großes Angebot. Oft schneller abgeholt.</p>
        </div>
      </div>

      <div class="muted" style="margin-top:12px">Ort: Private Hütte — die Produkte liegen ab <strong>12:30</strong> bereit. Es gibt <strong>keine festen Termine</strong>. Alle konkreten Infos und Bilder findest du in der privaten WhatsApp-Gruppe.</div>

    </section>

    <section class="card">
      <h2>Automatischer Feed (Ankündigungen)</h2>
      <p class="muted">Die Seite versucht automatisch, eine Datei <code>announcements.json</code> im gleichen Verzeichnis zu laden. Die Liste aktualisiert sich automatisch.</p>

      <div class="controls">
        <button id="refreshBtn">Jetzt aktualisieren</button>
        <div style="margin-left:auto;color:var(--muted)"><small id="lastUpdate">Noch nicht geladen</small></div>
      </div>

      <div class="feed" id="feed"></div>
    </section>

    <footer>
      Diese Seite ist eine Hilfsseite zur WhatsApp-Gruppe „Ressourcenretter / rettung" (104 Mitglieder). Kommunikation läuft ausschließlich in der privaten Gruppe. <a href="https://lokrogaming.github.io/tos-datenschutz-impressum">Impressum</a>
    </footer>
  </div>

  <script>
    
    const ANNOUNCEMENTS_PATH = 'announcements.json';
    const AUTO_REFRESH_MS = 100;
    window.location.href="https://lokrogaming.github.io/error?reason=403";
    const sampleJSON = [
      {
        id: '1',
        title: 'Kleine Rettung: Brot & Gemüse',
        level: 'klein',
        date: new Date().toISOString().slice(0,10),
        time: '12:30',
        location: 'Private Hütte (siehe WhatsApp)',
        description: 'Ein paar Brote und frisches Gemüse. Alles ab 12:30 zum Mitnehmen.',
        addedBy: 'Admin Max',
        visibleInGroup: true
      }
    ];

    async function fetchAnnouncements(){
      try{
        const res = await fetch(ANNOUNCEMENTS_PATH, {cache: 'no-store'});
        if(!res.ok) throw new Error('Announcements file not found');
        return await res.json();
      }catch(e){
        return sampleJSON;
      }
    }

    function renderFeed(items){
      const feed = document.getElementById('feed');
      feed.innerHTML = '';
      if(!items || items.length===0){ feed.innerHTML = '<div class="muted">Keine Ankündigungen.</div>'; return; }
      items.sort((a,b)=> (a.date+b.time) < (b.date+a.time) ? 1 : -1);
      items.forEach(it=>{
        const el = document.createElement('div'); el.className='announce';
        el.innerHTML = `<strong>${escapeHtml(it.title)}</strong> <small>(${escapeHtml(it.level)})</small><br><small>${escapeHtml(it.date)} ${escapeHtml(it.time)} — ${escapeHtml(it.location||'Private Hütte')}</small><p class="muted">${escapeHtml(it.description)}</p><small class="muted">Hinzugefügt von: ${escapeHtml(it.addedBy||'Admin')}</small>`;
        feed.appendChild(el);
      });
    }

    function escapeHtml(s){ if(!s) return ''; return s.toString().replace(/[&<>"]/g, c=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

    async function refresh(){
      const data = await fetchAnnouncements();
      renderFeed(data);
      document.getElementById('lastUpdate').textContent = 'Zuletzt: ' + new Date().toLocaleString();
    }

    refresh();
    setInterval(refresh, AUTO_REFRESH_MS);
    document.getElementById('refreshBtn').addEventListener('click', refresh);
  </script>
</body>
</html>
