<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ressourcenretter Low-Code JSON Editor</title>
<style>
  body{font-family:Arial,sans-serif;margin:0;padding:20px;background:#f7fafc;color:#111}
  h1{margin-bottom:16px}
  .announcement{border:1px solid #ccc;background:white;padding:12px;border-radius:8px;margin-bottom:12px}
  .announcement input, .announcement textarea, .announcement select{width:100%;padding:6px;margin-top:4px;margin-bottom:8px;border-radius:6px;border:1px solid #ccc;font-size:14px}
  button{padding:6px 10px;border:none;border-radius:6px;background:#16a34a;color:white;cursor:pointer;margin-right:6px;margin-top:4px}
  .btn-delete{background:#dc2626}
  .controls{margin-bottom:12px}
  .muted{color:#6b7280;margin-top:8px}
</style>
</head>
<body>
<h1>Ressourcenretter Low-Code JSON Editor</h1>
<p class="muted">Bearbeite die Ankündigungen ohne direktes JSON. Änderungen werden lokal gespeichert und können als Datei exportiert werden.</p>

<div class="controls">
  <button id="addAnn">Neue Ankündigung hinzufügen</button>
  <button id="downloadJson">Als JSON herunterladen</button>
  <div id="msg" class="muted"></div>
</div>

<div id="editor"></div>

<script>
const editor = document.getElementById('editor');
const msgEl = document.getElementById('msg');

// --- Lade vorhandene Ankündigungen ---
function loadAnnouncements(){
  const stored = localStorage.getItem('rr_announcements');
  const data = stored ? JSON.parse(stored) : [];
  renderAnnouncements(data);
}

// --- Rendern der Ankündigungen ---
function renderAnnouncements(data){
  editor.innerHTML = '';
  data.forEach((ann,index)=>{
    const div = document.createElement('div');
    div.className = 'announcement';
    div.innerHTML = `
      <label>Titel:<input type="text" value="${ann.title||''}" data-field="title"></label>
      <label>Level:
        <select data-field="level">
          <option value="klein" ${ann.level==='klein'?'selected':''}>klein</option>
          <option value="mittel" ${ann.level==='mittel'?'selected':''}>mittel</option>
          <option value="gross" ${ann.level==='gross'?'selected':''}>groß</option>
        </select>
      </label>
      <label>Datum:<input type="date" value="${ann.date||new Date().toISOString().slice(0,10)}" data-field="date"></label>
      <label>Zeit:<input type="time" value="${ann.time||'12:30'}" data-field="time"></label>
      <label>Ort:<input type="text" value="${ann.location||'Private Hütte (siehe WhatsApp)'}" data-field="location"></label>
      <label>Beschreibung:<textarea rows="2" data-field="description">${ann.description||''}</textarea></label>
      <label>Hinzugefügt von:<input type="text" value="${ann.addedBy||'Admin'}" data-field="addedBy"></label>
      <button class="btn-save">Speichern</button>
      <button class="btn-delete">Löschen</button>
    `;
    // Save button
    div.querySelector('.btn-save').addEventListener('click', ()=>{
      const updated = {};
      div.querySelectorAll('[data-field]').forEach(inp=>{
        updated[inp.dataset.field] = inp.value;
      });
      updated.id = ann.id || Date.now().toString();
      updated.visibleInGroup = true;
      data[index] = updated;
      localStorage.setItem('rr_announcements', JSON.stringify(data));
      msgEl.textContent = 'Ankündigung gespeichert.';
    });
    // Delete button
    div.querySelector('.btn-delete').addEventListener('click', ()=>{
      if(confirm('Ankündigung wirklich löschen?')){
        data.splice(index,1);
        localStorage.setItem('rr_announcements', JSON.stringify(data));
        renderAnnouncements(data);
        msgEl.textContent = 'Ankündigung gelöscht.';
      }
    });
    editor.appendChild(div);
  });
}

// --- Neue Ankündigung hinzufügen ---
document.getElementById('addAnn').addEventListener('click', ()=>{
  const stored = localStorage.getItem('rr_announcements');
  const data = stored ? JSON.parse(stored) : [];
  const newAnn = {id:Date.now().toString(), title:'', level:'klein', date:new Date().toISOString().slice(0,10), time:'12:30', location:'Private Hütte (siehe WhatsApp)', description:'', addedBy:'Admin', visibleInGroup:true};
  data.push(newAnn);
  localStorage.setItem('rr_announcements', JSON.stringify(data));
  renderAnnouncements(data);
});

// --- Download als JSON ---
document.getElementById('downloadJson').addEventListener('click', ()=>{
  const stored = localStorage.getItem('rr_announcements');
  if(!stored){ msgEl.textContent = 'Keine Ankündigungen zum Export.'; return; }
  const blob = new Blob([stored], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'announcements.json';
  a.click();
  URL.revokeObjectURL(url);
  msgEl.textContent = 'JSON-Datei erstellt.';
});

// --- Initial Load ---
loadAnnouncements();
</script>
</body>
</html>
